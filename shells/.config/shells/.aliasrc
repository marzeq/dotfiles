#!/usr/bin/env bash

alias ls="ls --color=auto"
alias la="ls -A"
alias grep="grep --color=auto"

alias c="clear"

if [ -f /etc/arch-release ]; then
  function remove-orphans() {
    orphans=$(pacman -Qdtq)
    if [ -n "$orphans" ]; then
      sudo pacman -Rns $orphans
    fi
  }

  if ! command -v paru &> /dev/null; then
    git clone https://aur.archlinux.org/paru-bin.git /tmp/paru-bin
    cd /tmp/paru-bin
    makepkg -si
    cd -
  fi

  alias update-system="paru && remove-orphans"
fi

loadenv() {
  if [ -z "$1" ]; then
    if [ -e ".env" ]; then
      set -a; source .env; set +a
    else
      echo "loadenv: no file specified and no .env file found in the current directory"
      return 1
    fi
  else
    if [ ! -e "$1" ]; then
      echo "loadenv: no such file or directory: ${1}"
      return 1
    fi

    if [ -d "$1" ]; then
      set -a; source ${1}/.env; set +a
    else
      set -a; source ${1}; set +a
    fi
  fi
}

compress() {
  if [ "$#" -eq 0 ]; then
    echo "compress: no arguments specified"
    return 1
  fi

  if [ "$1" = "-xz" ]; then
    compression_flag="J"
    extension=".tar.xz"
    shift
  elif [ "$1" = "-gz" ]; then
    compression_flag="z"
    extension=".tar.gz"
    shift
  elif [ "$1" = "-zip" ]; then
    command="zip -qr ${2}.zip ${@:2}"
    echo $command
    eval $command
    return
  elif [[ "$1" = -* ]]; then
    echo "compress: invalid flag: ${1}"
    return 1
  else
    compression_flag="z"
    extension=".tar.gz"
  fi

  if [ "$#" -eq 1 ]; then
    archive_name=$(basename ${1})
    command="tar -c${compression_flag}f $archive_name${extension} ${1}"
  else
    archive_name=${1}
    command="tar -c${compression_flag}f $archive_name${extension} ${@:2}"
  fi

  echo $command
  eval $command
}

extract() {
  if [ "$#" -eq 0 ]; then
    echo "extract: no file(s) specified"
    return 1
  fi

  for file in "$@"; do
    if [ ! -f "$file" ]; then
      echo "extract: no such file: ${file}"
      continue
    fi

    if [[ "$file" == *.tar.gz ]]; then
      basename=${file%.tar.gz}
      command="tar -xzf ${file} -C ${basename}"
    elif [[ "$file" == *.tar.xz ]]; then
      basename=${file%.tar.xz}
      command="tar -xf ${file} -C ${basename}"
    elif [[ "$file" == *.zip ]]; then
      basename=${file%.zip}
      command="unzip -q ${file} -d ${basename}"
    else
      extension=".${file#*.}"
      echo "extract: unknown file type: ${extension}"
    fi



    echo $command
    eval $command
  done
}

cl() {
  cd $1 && ls
}

editmkdir() {
  if [ -z "$1" ]; then
    echo "maybedit: no file specified"
    return 1
  fi

  mkdir -p $(dirname ${1})
  $EDITOR ${1}
}

